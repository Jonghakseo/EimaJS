"use strict";var __assign=function(){return __assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},__assign.apply(this,arguments)},__awaiter=function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j};Object.defineProperty(exports,"__esModule",{value:!0}),exports.eimaLint=void 0;var fs=require("fs"),inquirer_1=require("inquirer"),nanospinner_1=require("nanospinner"),util_1=require("./util");function eimaLint(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,inquirer_1["default"].prompt({name:"experimental",type:"list",message:"The Lint Feature Is Experimental And The Results May Not Be Accurate. Do You Still Want To Run It? (Y/N) [N]",choices:["Y","N"],default:function _default(){return"Y"}})];case 1:return b=c.sent(),"Y"===b.experimental?assetLint(a):process.exit(),[2];}})})}exports.eimaLint=eimaLint;function assetLint(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i=this;return __generator(this,function(j){switch(j.label){case 0:b=(0,util_1.getConfig)(),b&&0!==b.paths.length||((0,util_1.err)("Please Check eima.json"),process.exit()),b.lintPath||a||((0,util_1.err)("The Lint Feature Requires The Folder Path You Want To Search To. Please Check lintPath in eima.json or -p [path] argument"),process.exit()),j.label=1;case 1:return j.trys.push([1,4,,5]),[4,Promise.all(b.paths.map(function(a){var b=a.assets;return(0,util_1.getFileList)(b,[])}))];case 2:return c=j.sent(),d=c.flat(1/0).map(function(a){var c=a.name,d=a.ext;console.log({asset:a});var e=(0,util_1.getCasingType)(b.variableNameCasing),f=c.replace(/[^\w\s]/gim,"_")+"_"+d.toUpperCase();return __assign(__assign({},a),{name:f})}),e="".concat(a||b.lintPath),[4,(0,util_1.getFilePathList)(e,[""])];case 3:return f=j.sent(),g=f.filter(Boolean).flat(1/0),(0,util_1.mergeAllSourceFile)(e,g,function(a){return __awaiter(i,void 0,void 0,function(){var b,c,e,f,g;return __generator(this,function(h){switch(h.label){case 0:return b="EIMA ASSET LINT(ALPHA)\n\n--LIST OF NON IN-USE ASSETS--\n\n",c=d.map(function(c){var d=c.name,e=c.size,f=-1===a.indexOf(".".concat(d)),g=-1===a.indexOf("{".concat(d)),h=-1===a.indexOf("{ ".concat(d)),i=-1===a.indexOf(" ".concat(d,","));return f&&g&&h&&i?(b+="".concat(d," ----- ").concat(e,"\n"),c):null}).filter(Boolean),(0,util_1.box)([b]),[4,inquirer_1["default"].prompt({name:"delete",type:"list",message:"DO YOU WANT TO DELETE UNUSED FILES? \uD83D\uDDD1\uFE0F",choices:["Y","N"],default:function _default(){return"N"}})];case 1:return e=h.sent(),f=c.reduce(function(a,b){var c=b._fullFilePath;return a.concat(c)},[]),(0,util_1.box)(f.join("\n")),"Y"===e["delete"]&&(g=(0,nanospinner_1.createSpinner)("").start(),c.forEach(function(a){var b=a._fullFilePath;return fs.unlinkSync(b)}),g.success({text:"UNUSED FILES DELETED \u2705"})),process.exit(),[2];}})})}),[3,5];case 4:return h=j.sent(),console.error(h),process.exit(),[3,5];case 5:return[2];}})})}
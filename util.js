"use strict";var __awaiter=function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function sent(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j},__read=function(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,f,g=c.call(a),h=[];try{for(;(void 0===b||0<b--)&&!(d=g.next()).done;)h.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=g["return"])&&c.call(g)}finally{if(f)throw f.error}}return h},__spreadArray=function(a,b,c){if(c||2===arguments.length)for(var d,e=0,f=b.length;e<f;e++)(d||!(e in b))&&(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCasingType=exports.getConfig=exports.mergeAllSourceFile=exports.fixEslint=exports.createConfigFile=exports.makeSnakeWithUpperCaseName=exports.makeSnakeCaseName=exports.makeCamelCaseName=exports.makePascalCaseName=exports.getFilePathList=exports.getFileList=exports.getLineInput=exports.box=exports.help=exports.err=exports.msg=exports.log=exports.sleep=void 0;var path=require("path"),fs=require("fs"),util=require("util"),readline=require("readline"),chalk=require("chalk"),box_console_1=require("box-console"),constants_1=require("./constants"),eslint_1=require("eslint"),pattern=/[^ㄱ-ㅎ|가-힣\w\s]/,sleep=function(a){return void 0===a&&(a=900),new Promise(function(b){return setTimeout(b,a)})};exports.sleep=sleep,exports.log=console.log;var msg=function(a){return(0,exports.log)(chalk.greenBright(a))};exports.msg=msg;var err=function(a){return(0,exports.log)(chalk.red(a))};exports.err=err;var help=function(a){return(0,exports.log)(chalk.yellow(a))};exports.help=help;var box=function(a){return(0,box_console_1["default"])(a)};exports.box=box;function getLineInput(a){var b=readline.createInterface({input:process.stdin,output:process.stdout,terminal:!1});b.on("line",function(c){b.close(),a(c)})}exports.getLineInput=getLineInput;var readdir=util.promisify(fs.readdir);function getFileList(a,b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=b?"".concat(a,"/").concat(b.join("/")):a,[4,readdir(c)];case 1:return d=e.sent(),[2,Promise.all(d.map(function(d){var e=Math.round,f=path.resolve(c,d),g=fs.statSync(f);if(0<d.length&&"."===d.charAt(0))return null;if(g.isDirectory())return getFileList(a,__spreadArray(__spreadArray([],__read(b),!1),[d],!1));if(!g.isFile())return null;var h=d.split(".")[0];if(h.substr(0,1).match(/^[0-9]/))throw new Error("[".concat(constants_1.EIMA,"] A NUMBER CANNOT BE AT THE BEGINNING OF THE FILE NAME."));var i=path.extname(d).slice(1),j="kb",k=g.size,l=e(k/1024);1024<l&&(l=e(l/102.4)/10,j="mb");var m=d;return 0<b.length&&(h="".concat(b.join("_"),"_").concat(h),m="".concat(b.join("/"),"/").concat(d)),new Promise(function(a){a({name:h,ext:i,filePath:m,size:"".concat(l).concat(j),_fullFilePath:f,_rawSize:k})})}))];}})})}exports.getFileList=getFileList;function getFilePathList(a,b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=b?"".concat(a,"/").concat(b.join("/")):a,[4,readdir(c)];case 1:return d=e.sent(),[2,Promise.all(d.map(function(d){var e=path.resolve(c,d),f=fs.statSync(e);if(f.isDirectory())return getFilePathList(a,__spreadArray(__spreadArray([],__read(b),!1),[d],!1));if(!f.isFile())return null;var g=d;return 0<b.length&&(g="".concat(b.join("/"),"/").concat(d)),new Promise(function(a){a(g)})}))];}})})}exports.getFilePathList=getFilePathList;function makePascalCaseName(a,b,c){var d=__spreadArray([],__read(a),!1),e="".concat(d.map(function(a,b){return 0===b?a.toUpperCase():!pattern.test(a)&&a.trim()?a:pattern.test(d[b-1])?a.toUpperCase():void 0}).join("")).concat(c?"".concat(b[0].toUpperCase()).concat(__spreadArray([],__read(b),!1).slice(1).join("")):"");return e}exports.makePascalCaseName=makePascalCaseName;function makeCamelCaseName(a,b,c){var d=__spreadArray([],__read(a),!1),e="".concat(d.map(function(a,b){return 0===b?a.toLowerCase():"_"===d[b-1]||"-"===d[b-1]?a.toUpperCase():!pattern.test(a)&&a.trim()&&"_"!==a&&"-"!==a?a:pattern.test(a)?"":void 0}).join("")).concat(c?"".concat(b[0].toUpperCase()).concat(__spreadArray([],__read(b),!1).slice(1).join("")):"");return e}exports.makeCamelCaseName=makeCamelCaseName;function makeSnakeCaseName(a,b,c){var d="".concat(__spreadArray([],__read(a),!1).map(function(a){return!pattern.test(a)&&a.trim()?a.toLowerCase():pattern.test(a)?"_":void 0}).join("")).concat(c?"_".concat(b):"");return d}exports.makeSnakeCaseName=makeSnakeCaseName;function makeSnakeWithUpperCaseName(a,b,c){var d="".concat(__spreadArray([],__read(a),!1).map(function(a){return!pattern.test(a)&&a.trim()?a.toUpperCase():pattern.test(a)?"_":void 0}).join("")).concat(c?"_".concat(b.toUpperCase()):"");return d}exports.makeSnakeWithUpperCaseName=makeSnakeWithUpperCaseName;function createConfigFile(a){var b=a.target,c=a.assetPath,d=a.outputPath,e=a.variableName,f=a.variableNameCasing,g=a.isIncludingExt;return __awaiter(this,void 0,void 0,function(){var a,h;return __generator(this,function(){return a={target:b,hideSize:!1,isIncludingExt:g,variableNameCasing:f,lintPath:"src",paths:[{assets:c,out:d,vName:e}]},h=path.resolve(process.cwd(),"eima.json"),fs.writeFileSync(h,JSON.stringify(a)),[2]})})}exports.createConfigFile=createConfigFile;function fixEslint(a,b){return void 0===b&&(b=2015),__awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return c=new eslint_1.ESLint({fix:!0,overrideConfig:{parserOptions:{ecmaVersion:b}}}),[4,c.lintFiles([a])];case 1:return d=e.sent(),[4,eslint_1.ESLint.outputFixes(d)];case 2:return e.sent(),[2];}})})}exports.fixEslint=fixEslint;function mergeAllSourceFile(a,b,c){var d="",e=0;b.forEach(function(f){fs.readFile("".concat(a).concat(f),"utf-8",function(a,f){if(a)throw a;else-1===f.indexOf(constants_1.EIMA_ASSET_EXPORT_FILE)&&(d+=f),e+=1,e===b.length&&c(d)})})}exports.mergeAllSourceFile=mergeAllSourceFile;function getConfig(){var a=path.resolve(process.cwd(),"eima.json"),b=null;try{var c=JSON.parse(fs.readFileSync(a,"utf8"));c.paths&&0!==c.paths.length?b=c:(0,exports.help)("Please check paths property in eima.json")}catch(a){a.path&&a.path.includes("eima.json")||console.error(a)}return b}exports.getConfig=getConfig;var getCasingType=function(a){var b;switch(a){case"Camel":b=makeCamelCaseName;break;case"Snake":b=makeSnakeCaseName;break;case"Pascal":b=makePascalCaseName;break;default:b=makeSnakeWithUpperCaseName;}return b};exports.getCasingType=getCasingType;
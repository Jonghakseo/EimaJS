"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createConfigFile=createConfigFile,exports.fixEslint=fixEslint,exports.getConfig=getConfig,exports.getFileList=getFileList,exports.getFilePathList=getFilePathList,exports.getLineInput=getLineInput,exports.makeCamelCaseName=makeCamelCaseName,exports.makePascalCaseName=makePascalCaseName,exports.makeSnakeCaseName=makeSnakeCaseName,exports.makeSnakeWithUpperCaseName=makeSnakeWithUpperCaseName,exports.mergeAllSourceFile=mergeAllSourceFile;var _regenerator=_interopRequireWildcard(require("@babel/runtime/regenerator")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_util=_interopRequireDefault(require("util")),_readline=_interopRequireDefault(require("readline")),_constants=require("./constants"),_ink=require("./ink"),_eslint=require("eslint");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d["default"]=a,c&&c.set(a,d),d}var pattern=/[^ㄱ-ㅎ|가-힣\w\s]/;function getLineInput(a){var b=_readline["default"].createInterface({input:process.stdin,output:process.stdout,terminal:!1});b.on("line",function(c){b.close(),a(c)})}var readdir=_util["default"].promisify(_fs["default"].readdir);function getFileList(){return _getFileList.apply(this,arguments)}function _getFileList(){return _getFileList=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function c(a,b){var d,e;return _regenerator["default"].wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return d=b?"".concat(a,"/").concat(b.join("/")):a,c.next=3,readdir(d);case 3:return e=c.sent,c.abrupt("return",Promise.all(e.map(function(c){var e=Math.round;var f=_path["default"].resolve(d,c),g=_fs["default"].statSync(f);if(0<c.length&&"."===c.charAt(0))return null;if(g.isDirectory())return getFileList(a,[].concat((0,_toConsumableArray2["default"])(b),[c]));if(g.isFile()){var h=c.split(".")[0];if(h.substr(0,1).match(/^[0-9]/))throw new Error("[".concat(_constants.EIMA,"] A NUMBER CANNOT BE AT THE BEGINNING OF THE FILE NAME."));var i=_path["default"].extname(c).slice(1),j="kb",k=g.size,l=e(k/1024);1024<l&&(l=e(l/102.4)/10,j="mb");var m=c;return 0<b.length&&(h="".concat(b.join("_"),"_").concat(h),m="".concat(b.join("/"),"/").concat(c)),new Promise(function(a){a({name:h,ext:i,filePath:m,size:"".concat(l).concat(j),_fullFilePath:f,_rawSize:k})})}return null})));case 5:case"end":return c.stop();}},c)})),_getFileList.apply(this,arguments)}function getFilePathList(){return _getFilePathList.apply(this,arguments)}function _getFilePathList(){return _getFilePathList=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function c(a,b){var d,e;return _regenerator["default"].wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return d=b?"".concat(a,"/").concat(b.join("/")):a,c.next=3,readdir(d);case 3:return e=c.sent,c.abrupt("return",Promise.all(e.map(function(c){var e=_path["default"].resolve(d,c),f=_fs["default"].statSync(e);if(f.isDirectory())return getFilePathList(a,[].concat((0,_toConsumableArray2["default"])(b),[c]));if(f.isFile()){var g=c;return 0<b.length&&(g="".concat(b.join("/"),"/").concat(c)),new Promise(function(a){a(g)})}return null})));case 5:case"end":return c.stop();}},c)})),_getFilePathList.apply(this,arguments)}function makePascalCaseName(a,b,c,d,e){var f=(0,_toConsumableArray2["default"])(a),g="".concat(f.map(function(a,b){return 0===b?a.toUpperCase():!pattern.test(a)&&a.trim()?a:pattern.test(f[b-1])?a.toUpperCase():void 0}).join("")).concat(e?"".concat(b[0].toUpperCase()).concat((0,_toConsumableArray2["default"])(b).slice(1).join("")):"");return g}function makeCamelCaseName(a,b,c,d,e){var f=(0,_toConsumableArray2["default"])(a),g="".concat(f.map(function(a,b){return 0===b?a.toLowerCase():"_"===f[b-1]||"-"===f[b-1]?a.toUpperCase():!pattern.test(a)&&a.trim()&&"_"!==a&&"-"!==a?a:pattern.test(a)?"":void 0}).join("")).concat(e?"".concat(b[0].toUpperCase()).concat((0,_toConsumableArray2["default"])(b).slice(1).join("")):"");return g}function makeSnakeCaseName(a,b,c,d,e){var f="".concat((0,_toConsumableArray2["default"])(a).map(function(a){return!pattern.test(a)&&a.trim()?a.toLowerCase():pattern.test(a)?"_":void 0}).join("")).concat(e?"_".concat(b):"");return f}function makeSnakeWithUpperCaseName(a,b,c,d,e){var f="".concat((0,_toConsumableArray2["default"])(a).map(function(a){return!pattern.test(a)&&a.trim()?a.toUpperCase():pattern.test(a)?"_":void 0}).join("")).concat(e?"_".concat(b.toUpperCase()):"");return f}function createConfigFile(){return _createConfigFile.apply(this,arguments)}function _createConfigFile(){return _createConfigFile=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(a){var c,d,e,f,g,h,i,j;return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:c=a.target,d=a.assetPath,e=a.outputPath,f=a.variableName,g=a.variableNameCasing,h=a.isIncludingExt,i={target:c,hideSize:!1,isIncludingExt:h,variableNameCasing:g,lintPath:"src",paths:[{assets:d,out:e,vName:f}]},j=_path["default"].resolve(process.cwd(),"eima.json"),_fs["default"].writeFileSync(j,JSON.stringify(i));case 4:case"end":return b.stop();}},b)})),_createConfigFile.apply(this,arguments)}function fixEslint(){return _fixEslint.apply(this,arguments)}function _fixEslint(){return _fixEslint=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(a){var c,d,e,f=arguments;return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=1<f.length&&void 0!==f[1]?f[1]:2015,d=new _eslint.ESLint({fix:!0,overrideConfig:{parserOptions:{ecmaVersion:c}}}),b.next=4,d.lintFiles([a]);case 4:return e=b.sent,b.next=7,_eslint.ESLint.outputFixes(e);case 7:case"end":return b.stop();}},b)})),_fixEslint.apply(this,arguments)}function mergeAllSourceFile(a,b,c){var d="",e=0;b.forEach(function(f){_fs["default"].readFile("".concat(a).concat(f),"utf-8",function(a,f){if(a)throw a;else-1===f.indexOf(_constants.EIMA_ASSET_EXPORT_FILE)&&(d+=f),e+=1,e===b.length&&c(d)})})}function getConfig(){var a=_path["default"].resolve(process.cwd(),"eima.json"),b=null;try{var c=JSON.parse(_fs["default"].readFileSync(a,"utf8"));c.paths&&0!==c.paths.length?b=c:(0,_ink.help)("Please check paths property in eima.json")}catch(a){a.path&&a.path.includes("eima.json")||console.error(a)}return b}